# UR4Rec V2 with MoE + CLIP Configuration for MovieLens-100K
# 使用真实CLIP图片特征替代可训练embedding

# Dataset settings
num_items: 1682  # Will be overridden by actual data
max_seq_len: 50

# SASRec parameters
sasrec_hidden_dim: 512
sasrec_num_blocks: 3
sasrec_num_heads: 8
sasrec_dropout: 0.25

# Text encoder parameters
text_model_name: "all-MiniLM-L6-v2"
text_embedding_dim: 384
retriever_output_dim: 512

# CLIP parameters - 新增CLIP支持
use_clip: true  # 启用CLIP特征
clip_features_path: "UR4Rec/data/clip_features.pt"  # CLIP特征文件路径

# MoE parameters
moe_num_heads: 8
moe_dropout: 0.1
moe_num_proxies: 8

# Memory mechanism parameters
max_memory_size: 20
update_trigger: "INTERACTION_COUNT"
interaction_threshold: 5
drift_threshold: 0.3
decay_factor: 0.95

# Fusion parameters
fusion_method: "weighted"
sasrec_weight: 0.4
retriever_weight: 0.6

# Training parameters
sasrec_lr: 0.0005
retriever_lr: 0.001
use_uncertainty_weighting: false
use_adaptive_alternating: false

# Training stages - 使用真实图片特征应该带来额外提升
stages:
  - pretrain_sasrec      # 阶段1: 预训练SASRec
  - pretrain_retriever   # 阶段2: 预训练Retriever (with CLIP)
  - joint_finetune       # 阶段3: 联合微调
  - end_to_end          # 阶段4: 端到端训练

epochs_per_stage: 50
patience: 25

# Other settings
batch_size: 16
num_workers: 4
seed: 42
num_negatives: 20
