# UR4Rec V2 with MoE Configuration for MovieLens-100K

# Dataset settings
num_items: 1682  # Will be overridden by actual data
max_seq_len: 50

# SASRec parameters
sasrec_hidden_dim: 512  # Increased from 128 to match retriever output dim
sasrec_num_blocks: 3  # 增加到3层以学习更复杂的模式
sasrec_num_heads: 8   # 增加注意力头数
sasrec_dropout: 0.25  # 更强的正则化防止过拟合

# Text encoder parameters
text_model_name: "all-MiniLM-L6-v2"
text_embedding_dim: 384
retriever_output_dim: 512  # Increased from 256 to 512 for more capacity

# MoE parameters
moe_num_heads: 8  # Increased from 4 to 8 for better fusion
moe_dropout: 0.1
moe_num_proxies: 8  # Increased from 4 to 8 for richer representations

# Memory mechanism parameters
max_memory_size: 20  # Number of historical states to keep
update_trigger: "INTERACTION_COUNT"  # or "DRIFT_THRESHOLD", "TIME_BASED"
interaction_threshold: 5  # Update memory after N interactions
drift_threshold: 0.3  # Cosine similarity threshold for drift detection
decay_factor: 0.95  # Exponential decay for old memories

# Fusion parameters
fusion_method: "weighted"  # "weighted", "learned", or "adaptive"
sasrec_weight: 0.4    # SASRec提供baseline (目标~0.3-0.4)
retriever_weight: 0.6  # Retriever提供主要提升 (目标额外0.4-0.5)

# Training parameters
sasrec_lr: 0.0005      # Reduced from 0.001 for stability
retriever_lr: 0.001    # Reduced from 0.003 for stability
use_uncertainty_weighting: false  # 使用固定权重
use_adaptive_alternating: false  # 禁用自适应交替训练
adaptive_switch_threshold: 0.01
adaptive_min_steps: 5

# Training stages - 多阶段训练让retriever带来提升
stages:
  - pretrain_sasrec      # 阶段1: 预训练SASRec
  - pretrain_retriever   # 阶段2: 预训练Retriever
  - joint_finetune       # 阶段3: 联合微调
  - end_to_end          # 阶段4: 端到端训练

epochs_per_stage: 50   # 每阶段50 epochs，4阶段共200 epochs - more training time
patience: 25  # Increased from 15 to 25 for more exploration

# Other settings
batch_size: 16
num_workers: 4
seed: 42
num_negatives: 20  # 增加负样本数量以提升训练难度
