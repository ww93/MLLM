# UR4Rec V2 with MoE Configuration for MovieLens-100K - Improved Version
# 改进版配置，针对小数据集优化

# Dataset settings
num_items: 1682  # Will be overridden by actual data
max_seq_len: 50

# SASRec parameters - 增加dropout防止过拟合
sasrec_hidden_dim: 128  # 降低维度减少参数
sasrec_num_blocks: 2
sasrec_num_heads: 4
sasrec_dropout: 0.2  # 增加dropout提高泛化能力

# Text encoder parameters
text_model_name: "all-MiniLM-L6-v2"
text_embedding_dim: 384
retriever_output_dim: 128  # 降低维度与SASRec匹配

# MoE parameters
moe_num_heads: 4  # 减少头数
moe_dropout: 0.2  # 增加dropout
moe_num_proxies: 4

# Memory mechanism parameters
max_memory_size: 10
update_trigger: "INTERACTION_COUNT"
interaction_threshold: 5  # 降低阈值，更早更新memory
drift_threshold: 0.3
decay_factor: 0.95

# Fusion parameters
fusion_method: "weighted"
sasrec_weight: 0.7  # 增加SASRec权重，因为它在学习
retriever_weight: 0.3

# Training parameters - 关键改进
sasrec_lr: 0.001  # 提高5倍学习率
retriever_lr: 0.0005  # 提高5倍学习率
use_uncertainty_weighting: false  # 暂时禁用，使用固定权重
use_adaptive_alternating: false  # 禁用自适应交替，使用固定策略
adaptive_switch_threshold: 0.01
adaptive_min_steps: 5

# Training stages - 简化训练流程
stages:
  - pretrain_sasrec  # 先专注训练SASRec
  - joint_finetune   # 然后联合微调

epochs_per_stage: 50
patience: 10  # 增加patience

# Other settings
batch_size: 16  # 减小batch size提高更新频率
num_workers: 4
seed: 42

# Negative sampling - 增加难度
num_negatives: 10  # 增加负样本数量
